{% extends "base.html" %}

{% block title %}Swinging Demo{% endblock %}

{% block content %}

  <h1>Swinging Demo</h1>

  <p>This is only demo code, not ready for production yet.</p>

  <input id="file_input" type="file" accept="video/*"/>
  <input id="degree_input" type="number"/>

  <span id="video_current_time">-</span>
  <button id="step_forward_btn">step forwards</button>
  <button id="step_backward_btn">step backwards</button>
  <button id="record_position_btn">record position</button>

  <br>

  <video height="200" muted></video>



{% endblock %}

{% block javascript %}
  <script>

  jQuery(function ($) {
    console.log('starting');

    var $file_input = $("#file_input");
    var $degree_input = $("#degree_input");
    var video = $("video")[0];

    var $step_forward_btn  = $('#step_forward_btn');
    var $step_backward_btn = $('#step_backward_btn');
    var $record_position_btn = $('#record_position_btn');

    var step_increment = 0.04;

    $file_input.on('change', function (event) {
      var file = this.files[0];
      console.debug(file, file.type);

      // check that we can play this sort of file
      if (video.canPlayType(file.type)) {
        console.log('can play video');
        var fileURL = URL.createObjectURL(file);
        video.src = fileURL;
      } else {
        alert("can't play this kind of video");
      }

    });

    $(video).on('timeupdate', function () {
      $('#video_current_time').html(video.currentTime);
    });

    $step_forward_btn.on('click', function () {
      video.currentTime = video.currentTime + step_increment;
    });

    $step_backward_btn.on('click', function () {
      video.currentTime = video.currentTime - step_increment;
    });

    $record_position_btn.on('click', function () {
      console.log($degree_input.val(), video.currentTime);
    });

    $(document).keydown(function(e){
      var key = e.which;
      console.log(key);
      if ( key === 39 ) { $step_forward_btn.click(); }
      if ( key === 37 ) { $step_backward_btn.click(); }
      if ( key === 40 ) { $record_position_btn.click(); }
    });

  });

  </script>
{% endblock %}
